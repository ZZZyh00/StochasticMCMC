function gradient = gradLikelihood(theta, X, residual, lambda, steplength)
    % Function to compute the gradient given the data, current estimate of
    % theta and prior for theta
    
    % Asserting if theta is a row vector
    %assert(isrow(theta));
    
    d = length(theta) - 1;
    n = length(residual);
    
    sigmaSq = theta(end);
    beta = theta(1:end-1);
    
    gradient = zeros(size(theta));
    
    % Gradient wrt sigmaSq
    gradient(end) = (1 + n/2 + d/2) / sigmaSq - dot(residual, residual)/(2*sigmaSq^2)...
                        - lambda * norm(beta, 1) / (2 * sqrt(sigmaSq)^3);
    
    
    % Gradient wrt beta 
    % REsidual is y - xB
    gradF = - X' * residual / sigmaSq;  
    
    % Proximal gradient (after taking step wrt f)
    newBeta = beta - steplength * gradF;
    constant = steplength * lambda / sqrt(sigmaSq);
    
    % Computing the proximal gradient
    proxBeta = (beta < -constant) .* (beta + constant) + ...
                (beta > constant) .* (beta - constant);
    
    gradient(1:end-1) = tj
    
    % Evaluating the gradient
    %shifted = bsxfun(@minus, data, theta);
    gradient_p = theta; %(theta - priorPDF.mean) * priorPDF.precision; 
    gradient_L =  sum(shifted);
    %gradient = gradient_mapping_l1(theta, gradient_L, priorPDF.lambda, stepSize);
    gradient = gradient_p + gradient_L;
end